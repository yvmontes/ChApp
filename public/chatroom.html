<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ChApp</title>
    <script src="/socket.io/socket.io.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Rajdhani" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>

    <!-- <script src="./js/index.js"></script> -->
    <link rel="stylesheet" href="/style.css" type="text/css" />
    <script>
        $(function() {
            const socket = io()
            $("#windowbutton").click(function(e) {
                console.log("clicked");
                e.preventDefault(); // prevents page reloading
                //remove true ad=nd check for empty string
                if ($("#textbox")) {
                    outgoingMessage = {
                        username: sessionStorage.getItem("username"),
                        message: $("#textbox").val(),
                    }
                    socket.emit("chatMessage", outgoingMessage);
                    $("#textbox").val("");
                    return false;
                }
            });
            socket.on("chatMessage", function(msg) {
                $("#chatwindow-div").prepend(`<p class="message"><strong>${msg.username}:</strong> ${msg.message}</p>`);
            });
            socket.on("initialMessage", function(msg) {
                for(let i = msg.messages.length; i > 0; i--){
                    let username = msg.messages[i -1].username
                    let message = msg.messages[i - 1].chat
                    $("#chatwindow-div").prepend(`<p class="message"><strong>${username}:</strong> ${message}</p>`);
                }
                for(let i = 0; i < msg.rooms.length; i++){
                    $("#users-div").append(`<a href="/rooms/${msg.rooms[i]}"><strong><p>${msg.rooms[i]}</p></strong></a>`)
                }
            })
        });
    </script>
</head>

<body>

    <div class="container">
        <div id="window-title"><img src="/images/chaticon2.png" width="25px"> Welcome to ChApp
            <div class="imgholder">
                <img src="/images/mmc.png" width="70px"></div>
        </div>
        <div class="chatapp">
            <div class="dropdown">
                <a href="#" class="hvr-box-shadow-inset">View</a>
                <div class="dropdown-content">
                    <!-- <a href="#" id="users">Users</a>
                    <a href="#" id="rooms">Rooms</a> -->
                    <a href="/createroom">Create Room</a>

                </div>
            </div>
            &nbsp; <a href="/help" class="hvr-box-shadow-inset">Help</a>
            <hr>

            <b>General Chat</b>

            <div class="row">
                <div class="column">
                    <div id="chatwindow-div" class="message">
                    </div>
                </div>

                <div class="column2">
                    <div id="users-div">
                        <p>

                        </p>
                    </div>
                </div>

                <div class="row" id="form-div">
                    <form>
                        <textarea name="messege" class="form-control" id="textbox" rows="4" cols="150" placeholder="Type something..." onkeypress="process(event, this)"></textarea>

                        <!-- <textarea name="messege" class="form-control" id ="textbox" rows="4" cols="150" placeholder="Type something..." onkeypress="process(event, this)"></textarea>
                     -->
                        <br />
                        <button id="windowbutton">Send</button>
                        <!-- <input type="button" id="windowbutton" name="butClickHere" placeholder="click here" value="click here">
                 -->
                    </form>
                </div>
            </div>

        </div>
    </div>


    </div>

    <!-- JAVASCRIPT -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- <script src="./js/index.js"></script> -->
</body>

</html>